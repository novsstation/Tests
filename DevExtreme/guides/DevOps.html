<!--
title: DevOps
description: 
published: true
date: 2022-04-18T12:37:34.684Z
tags: 
editor: ckeditor
dateCreated: 2022-04-18T12:14:30.249Z
-->

<h2><strong>Internal NPM Registry</strong></h2>
<p><a href="http://npmproxy:4873/">http://npmproxy:4873/</a></p>
<p><strong>Note</strong>: VPN is required</p>
<p>Examples:</p>
<blockquote>
  <p>npm i devextreme@21.2-next&nbsp;--registry&nbsp;<a href="http://npmproxy:4873/">http://npmproxy:4873/</a></p>
</blockquote>
<blockquote>
  <p>yarn add devextreme@21.2-next --registry <a href="http://npmproxy:4873/">http://npmproxy:4873/</a></p>
</blockquote>
<p>&nbsp;</p>
<p><code>npx</code>&nbsp;doesn't support the&nbsp;<code>--registry</code>&nbsp;flag, you can use the corresponding environment variable (affects current&nbsp;process, e.g. terminal instance):</p>
<blockquote>
  <p>set npm_config_registry=<a href="http://npmproxy:4873/%20">http://npmproxy:4873/</a><br>npx devextreme-cli -v</p>
</blockquote>
<p>If you need a nightly build, you should specify the XX-next tag</p>
<p>&nbsp;</p>
<h2><strong>Updating a Docker image</strong></h2>
<p><a href="https://github.com/DevExpress/DevExtreme/tree/20_2/build/docker-image">https://github.com/DevExpress/DevExtreme/tree/20_2/build/docker-image</a></p>
<ul>
  <li>Нужно знать докер</li>
  <li>Собирается образ, с чистого листа</li>
  <li>Метится временным тегом* и проверяется на отдельной ветке (или локально, если времени не жалко)<ul>
      <li><code>docker build -t devexpress/devextreme-build:YYYY-MM-DD</code></li>
    </ul>
  </li>
  <li>Если всё норм, то помечается тегом XX_X<ul>
      <li>docker tag devexpress/devextreme-build:YYYY-MM-DD devexpress/devextreme-build:XX_X docker push devexpress/devextreme-build:XX_X</li>
    </ul>
  </li>
</ul>
<p>* Этот вариант - с заливкой на девэкстримоский хаб, чтобы иметь возможность залить образ и манипулировать тегами - необходимо иметь соответствующие права на хабе</p>
<p>&nbsp;</p>
<h2><strong>Gulp</strong></h2>
<p>Don't use&nbsp;<code>path.join</code>&nbsp;within&nbsp;<code>gulp.src</code>&nbsp;since it incorrectly determines&nbsp;<a href="https://gulpjs.com/docs/en/api/concepts#glob-base">glob base</a>&nbsp;(Possible WA: use&nbsp;<code>base</code>&nbsp;or&nbsp;<code>cwd</code>&nbsp;<a href="https://gulpjs.com/docs/en/api/src#options">option</a>)</p>
<p>See&nbsp;<a href="https://github.com/gulpjs/gulp/issues/2085">https://github.com/gulpjs/gulp/issues/2085</a></p>
<p>&nbsp;</p>
<h2><strong>GitHub Actions</strong></h2>
<h3><strong>Style Guide (YAML)</strong></h3>
<p><strong>Naming conventions</strong></p>
<ul>
  <li>Workflow name is noun-like. It's a name for a group of assertions</li>
  <li>Job name is noun-like. It's an assertion</li>
  <li>Step name is verb-like. It&nbsp;answers a question "what to do?" (like a commit message)</li>
  <li>When something fails a&nbsp;human see <code>&lt;Workflow name&gt; / &lt;Job name&gt;</code> on the GitHub. A couple of these&nbsp;names&nbsp;should make sense</li>
  <li>Names are for humans. It means words separated by spaces, the first starts with a capital, no period in the end</li>
</ul>
<p>Good:</p>
<p>A name for something</p>
<p>Bad:</p>
<p>a name for something A name for something. A-name-for-something A_NAME_FOR_SOMETHING</p>
<p>&nbsp;</p>
<p><strong>Letter Case</strong></p>
<p>All that can be used with dot notation is lowerCamelCased</p>
<ul>
  <li>secrets</li>
  <li>step ids</li>
  <li>script variables (bash)</li>
  <li>jobs</li>
  <li>environment variables (except for 3rd party variables)</li>
</ul>
<p>Other YAML keys should be kebab-cased if possible</p>
<p>&nbsp;</p>
<p><strong>Newlines</strong></p>
<p>YAML is sparse enough and there is no need for extra lines except for this cases:</p>
<ul>
  <li>before and after each job</li>
  <li>before and after each step<br>&nbsp;</li>
</ul>
<p><strong>Spaces</strong></p>
<ul>
  <li>2 spaces are used for tabulation</li>
  <li>Array items are prefixed with tabulation and a '-' symbol</li>
</ul>
<p>Good:</p>
<p>types: &nbsp;&nbsp;- opened</p>
<p>Bad:</p>
<p>types: - opened</p>
<p>&nbsp;</p>
<h2><strong>Useful Tips</strong></h2>
<p>&nbsp;</p>
<h3><strong>Use env variables</strong></h3>
<p>For better readability use env variables for github context values:</p>
<p>- name: Check version bump PRif: &nbsp;steps.versionBump.outputs.changed &nbsp;env: &nbsp;&nbsp; &nbsp;title: ${​​​​​​​{​​​​​​​github.event.pull_request.title}​​​​​​​​​​​​​​​​​​​​​​​​​​​​}​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​ &nbsp;&nbsp;&nbsp;version: ${​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​{​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​steps.versionBump.outputs.version}​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​}​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​</p>
<p>&nbsp;</p>
<h3><strong>Multiline scripts</strong></h3>
<p>YAML has several ways of&nbsp;breaking string over multiple lines (e.g. see&nbsp;<a href="https://www.baeldung.com/yaml-multi-line">this article</a>). These&nbsp;are the most common for writing scripts:</p>
<ul>
  <li>Literal style (recommended)</li>
</ul>
<p>Keeps&nbsp;line breaks but reduces empty lines at the end of the string</p>
<p>run:&nbsp;| &nbsp;&nbsp;echo&nbsp;foo &nbsp;&nbsp;echo&nbsp;bar</p>
<ul>
  <li>Folded style</li>
</ul>
<p>Line breaks are replaced by space characters for consecutive non-empty lines</p>
<p>run: &gt; &nbsp;echo foo &nbsp;echo bar</p>
<p>Joining lines into&nbsp;one can result in unexpected errors in bash, thus Literal style is recommended.</p>
<p>&nbsp;</p>
<h3><strong>FAQ</strong></h3>
<p>&nbsp;</p>
<p><strong>Why checks frozen with "Expected -&nbsp;Waiting for status to be reported" status?</strong></p>
<p>This occurs when the check is marked as required in the branch protection rules, but was not triggered for the PR</p>
<p>More details: <a href="https://github.community/t/expected-waiting-for-status-to-be-reported/18001">https://github.community/t/expected-waiting-for-status-to-be-reported/18001</a></p>
<p>Why some checks disappear after changes were&nbsp;added to the branch?</p>
<p>It seems that GitHub only lists the checks from the latest check suite. If a check is not triggered on <code>synchronize</code>&nbsp;event it won't be included in the latest suite.</p>
<p>More details: <a href="https://github.community/t/bug-report-failed-status-checks-getting-removed-after-commit-from-the-github-action-bot/17370">https://github.community/t/bug-report-failed-status-checks-getting-removed-after-commit-from-the-github-action-bot/17370</a></p>
<p>&nbsp;</p>
<h2><strong>hg</strong></h2>
<p><strong>Наши репозитории:</strong></p>
<ul>
  <li><a href="https://hg/mobile">https://hg/mobile</a></li>
  <li><a href="https://hg/devextreme-metadata-tools/">https://hg/devextreme-metadata-tools/</a></li>
  <li><a href="https://hg/HgAdapter/">https://hg/HgAdapter/</a></li>
</ul>
<p><strong>Если завис адаптер:</strong></p>
<ul>
  <li>может залочиться репозиторий. Можно попробовать запустить <code>hg recover</code> (на машине hg в директории C:\Hg\repos\mobile, по RDP туда есть доступ у Мартынова, Звягина, Митрохина, Жаворонкова)</li>
  <li>See more -</li>
</ul>
<p><a href="https://teams.microsoft.com/l/message/19:d6e62127a8034edebaa1d4c6050e3150@thread.skype/1586334136182?tenantId=e4d60396-9352-4ae8-b84c-e69244584fa4&amp;groupId=f74b7d18-34a4-4c78-b7d5-b56e55ce3236&amp;parentMessageId=1586334136182&amp;teamName=Teams%20Collaborations&amp;channelName=DevExtreme%20CI%20and%20DevOps&amp;createdTime=1586334136182">Alexey Martynov (DevExpress): Boris Krylov (DevExpress) сообщает: каккаято беда …&nbsp;</a></p>
<p>posted in Teams Collaborations / DevExtreme CI and DevOps at Apr 8, 2020 11:22 AM</p>
<p><strong>Syncer bot:</strong></p>
<ul>
  <li>sources: <a href="https://github.com/DevExpress/devextreme-repo-syncer/">https://github.com/DevExpress/devextreme-repo-syncer/</a></li>
  <li>Check bot state via ssh (<i>login: dx, password: dx, port: 22</i>):</li>
</ul>
<blockquote>
  <p>ssh&nbsp;dx@devextreme-mini-server</p>
  <p>sudo&nbsp;-H&nbsp;bash<br>cd /opt/devextreme-repo-syncer/<br>./tail.sh</p>
</blockquote>
<p>To restart containers, follow the steps from the previous point, but instead of the <i>./tail.sh</i> run: <i>./stop.sh</i>, then <i>./start.sh</i></p>
<p><strong>More info about hg adapter:</strong></p>
<p>HGAdapter is a middleware that enables Mercurial as VCS for CCNet. It allows to check for modifications, and to get changed files in the DXBuild-acceptable format.</p>
<p>&nbsp;</p>
<p>You can find sources in the following repo: <a href="https://github.com/DevExpress/HgAdapter"><u>https://github.com/DevExpress/HgAdapter</u></a></p>
<p>After changing, you should</p>
<ol>
  <li>Build the solution in the <strong>Release</strong> configuration</li>
  <li>Publish the result to the DXVCS at: <strong>$/CCNetConfig/Server/hg/</strong></li>
</ol>
<p>&nbsp;</p>
<p>If you need to change DXBuild-specific parts of code, you need to modify one (or both) of the following files (DXVCS links below):</p>
<ul>
  <li>$/InternalSoftware/DXBuild/DXBuild.Core/Mercurial.cs</li>
  <li>$/InternalSoftware/DXBuild/DXBuild.Core/MercurialDriver.cs</li>
  <li>When changing any of the files above, ask Boris Krylov directly to update DXBuild</li>
</ul>
<p>&nbsp;</p>
<p>To see HGAdapter logs, check out the following directory:</p>
<ul>
  <li><a href="https://teams.microsoft.com/_"><u>\\ciserver\LocalProjects\DevExtreme\21.2\QUnit_Build</u></a></li>
  <li>You can modify the directory above according to the task you need to analyze</li>
</ul>
<p><strong>Виснущий докген</strong></p>
<p><i>(Если hg recover не помогает)</i></p>
<p>Иногда синхронизилка создаёт коммит, но убивается до того, как замёржит (по неясным причинам, возможно, таймаут таски). После этого HG говорит что-то типа "у тебя тут куча head-ов, выбери что-то или отстань от меня"<br>Поэтому, локальные головы можно прибить, учитывая, что они особо не нужны:</p>
<ul>
  <li>при помощи hg outgoing можно посмотреть что мы будем лить на сервак<i> (login: buildmaker, password:buildmaker)</i></li>
  <li>если что-то есть, то:<ul>
      <li>для начала надо разрешить экстеншен strip - для этого откроем файл hgrc в папке .hg, впишем следующее:</li>
    </ul>
  </li>
</ul>
<blockquote>
  <p>[extensions]</p>
  <p>strip =</p>
  <p>либо не впишем, если уже вписано</p>
</blockquote>
<ul>
  <li>При помощи данного экстеншена можно эти коммиты (и их наследники) прибить</li>
  <li>Будем убивать по комиту, они идут от старых к новым (сверху вниз). Учтите, что наследники коммитов будут убиваться, иногда команда hg strip может ругнуться на несуществующий коммит.</li>
  <li>После убивания коммитов мы придём к тому, что hg outgoing скажет, что локальных ченжей больше не осталось (мы всё вычистили).</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><br>&nbsp;</p>
