<!--
title: API Declarations
description: 
published: true
date: 2022-04-18T13:05:38.805Z
tags: 
editor: ckeditor
dateCreated: 2022-04-18T13:05:36.359Z
-->

<h2><strong>FAQ on how to work with declarations</strong></h2>
<ol>
  <li>Q: У нас появились новые d.ts файлы, разложенные почти везде. Зачем?</li>
</ol>
<p>A: эти d.ts файлы - модули - у нас есть уже давно, но раньше они генерировались при билдежке и были плохими (слабая типизация, неправильные экспорты, падения в рантайме). Теперь они стали чуть лучше и - стали сорцами, а не генерируемым кодом, и теперь мы можем&nbsp;их использовать для улучшения нашего TS и МетаДанных</p>
<p>2) Q: док-тэги (док-комменты) есть и в .js и в .d.ts файлах. Какие-то из них не нужны?</p>
<p>A: Нужны и те и те. С первого раза не удалось автоматически перенести все док-тэги из .js в .d.ts, поэтому часть осталась на своих местах&nbsp;(чаще всего это поля вложенных объекты).</p>
<p>3) Q:&nbsp;Я пишу новую декларацию, что для этого нужно?</p>
<p>A: Нужно внести соотв. изменения в d.ts файл: добавить TS-декларацию и приклеить к нему док-тэг. В .js писать НОВЫЕ док-тэги в общем случае НЕ НУЖНО (в частном случае пишите сюда в канал)</p>
<p>4) Q:&nbsp;Я меняю старую декларацию, что для этого нужно?</p>
<p>A: Нужно внести соотв. изменения в d.ts файл:&nbsp;обновить&nbsp;TS-декларацию. Предполагается, что док-коммент&nbsp;уже есть (мы же меняем старую декларацию), если он в .d.ts - меняем в d.ts, если в .js - меняем в .js. Т.е. все просто - где лежит, там и меняем.</p>
<p>5) Q: нужно ли обновлять dx.all.d.ts ?</p>
<p>A: да, так же, как и раньше, см.&nbsp;<a href="https://teams.microsoft.com/l/entity/com.microsoft.teamspace.tab.wiki/tab::2bd851b6-bd63-41ab-bde1-8f1c9de4b600?context=%7B%22subEntityId%22%3A%22%7B%5C%22pageId%5C%22%3A28%2C%5C%22sectionId%5C%22%3A30%2C%5C%22origin%5C%22%3A2%7D%22%2C%22channelId%22%3A%2219%3A7a8fe7395a2d47288c29cfc421df6cbf%40thread.skype%22%7D&amp;tenantId=e4d60396-9352-4ae8-b84c-e69244584fa4">Updating dx.all.d.ts</a>.</p>
<p>6) Q: Сложно-сложно-ничего-не-понятно, зачем так?</p>
<p>A: <s>Денег нет, но вы держитесь</s>&nbsp;Сорцы находятся в процессе миграции, в скором будущем вся мета-инфа будет только в d.ts, потом вместо док-тэгов информация будет браться напрямую из TS-декларации, а потом и вместо d.ts+.js будут только .ts. Будет гибче, стабильнее, и удобнее (-:</p>
<p>&nbsp;</p>
<h2><strong>Useful Tips</strong></h2>
<ol>
  <li>в .d.ts файлах док-тэги достаются только из типов, которые экспортятся (прямо или косвенно, как тип какого-то поля). Просто повесить блок док-тэгов "в воздухе", не привязанных ни к какому мемебру не выйдет. В&nbsp;.js&nbsp;так можно.</li>
  <li>в .d.ts файлах нельзя писать больше одного блока док-тэгов для одного элемента. Один многострочный коммент - это ОК. Несколько многострочных или однострочных - не ОК.</li>
  <li>для указания имени в .js файлах используется тэг @name, в .d.ts - @docid</li>
</ol>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2><strong>Internal purposes warning</strong></h2>
<p><code><strong>Warning! This type is used for internal purposes. Do not import it directly.</strong></code></p>
<p>&nbsp;</p>
<p>Это сообщение, которым у нас помечаются&nbsp;<strong>все&nbsp;не публичные TS типы</strong>.</p>
<p>После билдежки пакета специальная тулза пробегает по сорцам и ко всему, что может заимпортить пользователь и что не помечено тэгом <code>@public</code>&nbsp;приклеивает это сообщение. Так должно помечаться всё, что непублично, если что-то где-то не пометилось, или, наоборот, пометилось зря - пишите в&nbsp;тред:&nbsp;<a href="https://teams.microsoft.com/l/message/19:7a8fe7395a2d47288c29cfc421df6cbf@thread.skype/1595940663832?tenantId=e4d60396-9352-4ae8-b84c-e69244584fa4&amp;groupId=8c31b3e5-5870-46b1-92a7-180d13b282ed&amp;parentMessageId=1595940663832&amp;teamName=DevExtreme&amp;channelName=General&amp;createdTime=1595940663832">Warning! This type is used for internal purposes. Do no…&nbsp;</a></p>
<p>&nbsp;</p>
<h2><strong>Updating dx.all.d.ts</strong></h2>
<ol>
  <li>d.ts генерируется на основе доккоментов. Для того, чтобы скорректировать существующие опции\методы или добавить новые - надо обновить доккоменты.</li>
  <li>Для генерации d.ts - запустить <strong>npm run update-ts</strong></li>
</ol>
<p>&nbsp;</p>
<h2><strong>Updating StrongMetaData.json</strong></h2>
<p>StrongMetaData.json is stored in the hg/mobile repo and is used for generating ASP.NET (and Core) wrappers.</p>
<p>Once the API declarations are changed the corresponding DevExtreme StrongMetaData Check task will generate a new StrongMetaData.json.</p>
<p>If changes detected the task goes red</p>
<p>To update the StrongMetaData.json in the repository&nbsp;go to the \DevExtreme.AspNet.Mvc folder and run the Update-Mvc-Metadata.ps1 script:</p>
<blockquote>
  <p>powershell.exe -executionpolicy unrestricted ./Update-Mvc-Metadata.ps1</p>
</blockquote>
<p>After that you can check the updated version grabbed to your local repository, commit it and push. The task will go green after that.</p>
<p>&nbsp;</p>
<h2><strong>Hiding inherited properties</strong></h2>
<p>Assuming&nbsp;we need to add a new type <code>DerivedType</code>&nbsp;derived some, but not&nbsp;all the properties from&nbsp;<code>BaseType</code>.</p>
<p>Step 1&nbsp;provides clean&nbsp;public type for TS projects.</p>
<p>Steps 2 and 3 make&nbsp;doc topics&nbsp;work properly.</p>
<p><a href="https://www.typescriptlang.org/play?ssl=28&amp;ssc=2&amp;pln=21&amp;pc=1#code/PTAEF5K6fAoEoAKAnApugjgVwJYGdcAXNfBMWSqOGxAeQFtjQATAe1NADs2jQ0AHgT64uoACoBlUAB5QAZgB0AVkUBGADSgA7mlAALAIYA3PUTahs+PW21j9aADYAHDKCIBPV+VC4GzthQ+SQBrXGdQADMUNgZQAHIAK3xgAGNAtGBRFkF4gG44QQCg9y89UPCZcS0AaX4BEi4WfFAQtA82SIkAPghkXFSQqq0AUQFUx2wcmTaOrurQGu7ugp92VIBaIkMAcxbDdFB8MOdXFl8xIgd6w39HNALREhRIw1S9ACFDa3Ey0ABvOCgYE5FC4UwsVBsZwALm42AYACMMAVgQZcCwclwACIYcFoSExWFHIhgrg7AoAX1oFColB8Y1uznuPjp9NoACoOQACgACzmwiMcA25HOAhQExSI3M8rm5uLBEN+cvAoAqzhkCvxLGVaA+jkMXBCGm58X0GKxWohUOc8V6ADIAXBuS7ucAuc7XaK+QKhQNPa6ebz1hiAy6xUC0bYuDaYdz8KTRBS4NSEB7vfzBcLUs6gyHzlaCbrc3yioE+IWdWVc+KnhhXu9QJXdfrDSFuYJGs1uV8fn9-oBoAiHw6HYfdHLDGfNmLQXEnebYqQx8rxSrKimnltXBJt8-FrvRM5x28J0Ljho8VJHI6AA">Playground</a></p>
<p>&nbsp;</p>
<h3><strong>Step 1</strong></h3>
<p>Add a public&nbsp;type skipping hidden properties. Note it is a <code>type</code>, not an <code>interface</code>. <code>DerivedTypeBlank</code> is defined in the next step.</p>
<p>Add new properties if required. The properties must have <code>docid</code>&nbsp;without value (it is calculated automatically)</p>
<pre><code class="language-plaintext">/**&nbsp;@public&nbsp;*/
export&nbsp;type&nbsp;DerivedType&nbsp;=&nbsp;Skip&lt;DerivedTypeBlank,&nbsp;'hiddenDerivedProp'&gt;&nbsp;&amp;&nbsp;{​​​
&nbsp;&nbsp;&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@public
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@docid
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;ownProp:&nbsp;string;
}​​​​​​​​​​</code></pre>
<p>&nbsp;</p>
<h3><strong>Step 2</strong></h3>
<p>Add an<code>interface</code>&nbsp;called&nbsp; <code>DerivedTypeBlank</code>. This is an intermediate type for holding doc-tags.<code>Blank</code>&nbsp;is a common suffix used in such cases.</p>
<p>The blank type</p>
<ul>
  <li>is not for customers' usage&nbsp;and <strong>must not be exported</strong></li>
  <li>must have explicit <code>docid</code>&nbsp;tag with value</li>
  <li>must have explicit&nbsp;<code>export</code>&nbsp;tag with value: the name of the <strong>public type</strong>&nbsp;defined in the previous step&nbsp;- <code>DerivedType</code>&nbsp;(not the blank type)</li>
  <li>must have explicit&nbsp;<code>inherits</code>&nbsp;tag with value: docid of the base type<br>&nbsp;</li>
</ul>
<h3><strong>Step 3</strong></h3>
<p>Override inherited properties that should be removed.</p>
<p>The properties</p>
<ul>
  <li>must&nbsp;have explicit <code>docid</code> tag value: the name of the <strong>public type</strong>&nbsp;defined in the previous step&nbsp;-&nbsp;<code>DerivedType</code>&nbsp;(not the blank type) plus the property name.</li>
  <li>should have <code>any</code>&nbsp;type.</li>
</ul>
<pre><code class="language-plaintext">&nbsp;/**
&nbsp;*&nbsp;@docid&nbsp;DerivedType
&nbsp;*&nbsp;@export&nbsp;DerivedType
&nbsp;*&nbsp;@inherits BaseType
&nbsp;*/
interface&nbsp;DerivedTypeBlank&nbsp;extends&nbsp;BaseType&nbsp;{​​​​​​​​​​​​​​​​​​
&nbsp;&nbsp;&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@hidden
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@docid&nbsp;DerivedType.hiddenDerivedProp
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;hiddenDerivedProp:&nbsp;any;
}​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​
</code></pre>
<p><br>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><br>&nbsp;</p>
